<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TikTok & Instagram Automation (Neon + HeyGen)</title>
  <style>
    :root{--bg:#0b0c10;--card:#111318;--muted:#9aa4b2;--border:#1f2430;--brand:#00D09C;--ok:#22c55e;--danger:#ef4444}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;background:var(--bg);color:#e5e7eb}
    .wrap{max-width:1024px;margin:24px auto;padding:16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:16px}
    h1{font-size:22px;margin:0 0 12px} h2{font-size:18px;margin:8px 0}
    label{display:block;font-size:12px;color:var(--muted);margin-top:10px}
    input,select,textarea{width:100%;padding:10px;margin-top:6px;background:#0f1116;border:1px solid #2a3140;border-radius:10px;color:#e5e7eb}
    button{background:var(--brand);color:#0b0c10;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
    button:disabled{opacity:.5;cursor:not-allowed}
    .row{display:grid;grid-template-columns:1fr 1fr; gap:12px}
    .row3{display:grid;grid-template-columns:1fr 1fr 1fr; gap:12px}
    .row4{display:grid;grid-template-columns:1fr 1fr 1fr 1fr; gap:12px}
    .hint{font-size:12px;color:#9aa4b2}
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:8px;border-bottom:1px solid var(--border);text-align:left;vertical-align:top}
    tr.clickable{cursor:pointer}
    tr.clickable:hover{background:#0f141a}
    .badge{display:inline-block;background:#151a22;border:1px solid #273042;padding:3px 8px;border-radius:999px;margin-right:6px;font-size:11px}
    .status-ok{color:var(--ok);font-weight:700}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;align-items:center}
    .toolbar input[type=file]{display:none}
    .topbar{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .link{background:#263042;color:#e5e7eb;border:1px solid #273042}
    .danger{background:transparent;border:1px solid var(--danger);color:#fecaca}
    .hidden{display:none}
    @media (max-width:740px){ .row3{grid-template-columns:1fr} .row{grid-template-columns:1fr} .row4{grid-template-columns:1fr 1fr} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card topbar">
      <div>
        <h1 style="margin:0">TikTok & Instagram Automation (Neon + HeyGen)</h1>
        <div class="hint">Daten zentral in Neon Postgres. Brand: <span class="badge">#00D09C</span></div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="btnGoComposer">Composer</button>
        <button id="btnGoSettings" class="link">Einstellungen</button>
      </div>
    </div>

    <!-- ===== MAIN VIEW (Composer + Library) ===== -->
    <div id="viewMain">
      <div class="card" id="composerCard">
        <h2>Composer</h2>
        <div class="row4">
          <div>
            <label>Plattform</label>
            <select id="platform"><option value="tiktok">TikTok</option><option value="instagram">Instagram</option></select>
          </div>
          <div>
            <label>Account (nach Plattform)</label>
            <select id="account"></select>
          </div>
          <div>
            <label>Format</label>
            <select id="format"><option value="post">Post / Reel</option><option value="story">Story (≤ 15s)</option></select>
          </div>
          <div>
            <label>TikTok Modus</label>
            <select id="ttMode"><option value="direct">Direct Post</option><option value="draft">Draft (Trend-Sound später)</option></select>
          </div>
        </div>

        <div class="row3">
          <div><label>Avatar</label><select id="avatar"><option>Avatar 1</option><option>Avatar 2</option><option>Avatar 3</option><option>Avatar 4</option></select></div>
          <div><label>Stimme</label><select id="voice"><option>Katja (w, DE)</option><option>Conrad (m, DE)</option><option>Ingrid (w, AT)</option><option>Leni (w, CH)</option></select></div>
          <div><label>Brand-Farbe</label><input type="color" id="brand" value="#00D09C" /></div>
        </div>

        <div><label>Look / Stil-Notiz</label><input id="look" placeholder="Hintergrund, Licht, Kleidung, Stimmung" value="Dunkler Hintergrund, Teal-Akzent, seriös, ruhige Mimik"/></div>

        <div class="row3">
          <div><label>Wasserzeichen</label><select id="wmOn"><option value="true">Aktiv</option><option value="false">Aus</option></select></div>
          <div><label>Wasserzeichen-Text</label><input id="wmText" placeholder="@deinusername" value="@deinusername"/></div>
          <div><label>Musik</label><select id="music"></select></div>
        </div>

        <div class="row3">
          <div>
            <label>Renderer</label>
            <select id="renderEngine">
              <option value="heygen" selected>HeyGen (Avatar + Captions)</option>
              <option value="did_plus_captions">D‑ID → Captions via Json2Video</option>
              <option value="did_only">Nur D‑ID (ohne UT)</option>
              <option value="json2video_only">Nur Json2Video (Template)</option>
            </select>
          </div>
          <div>
            <label>Posting-Modus</label>
            <select id="postMode">
              <option value="download_only">Nur rendern (Download-Link)</option>
              <option value="auto_upload">Auto-Upload (falls konfiguriert)</option>
            </select>
          </div>
          <div>
            <label>Hinweis</label>
            <div class="hint">TikTok heute: <b>Nur rendern</b> wählen, dann im TikTok Studio planen.</div>
          </div>
        </div>

        <div class="row3">
          <div>
            <label>Untertitel einbrennen</label>
            <select id="captionsOn"><option value="true" selected>Ja (empfohlen)</option><option value="false">Nein</option></select>
          </div>
          <div>
            <label>Hook als On‑Screen‑Text (erste 3s)</label>
            <select id="hookOverlayOn"><option value="true" selected>Ja</option><option value="false">Nein</option></select>
          </div>
          <div>
            <label>Hook‑Stil</label>
            <select id="hookStyle"><option value="top">Oben, Bold</option><option value="center">Zentriert, Bold</option><option value="bottom">Unten, Bold</option></select>
          </div>
        </div>

        <div><label>Hook</label><input id="hook" placeholder="Starker Einstiegssatz" value="90 % scheitern – vermeide diese 3 Fallen…"/></div>
        <div><label>Skript (Voiceover)</label><textarea id="script" rows="5">Kurzer Beispiel-Text fürs Voiceover …</textarea></div>
        <div><label>Hashtags</label><input id="tags" value="#kibusiness #digitalbusiness #futureofwork #arbeitmitki #onlinebusiness" /></div>
        <div><label>Caption (Kurz-Titel)</label><input id="caption" placeholder="z. B. 'Mit KI in 7 Tagen starten'" /></div>
        <div><label>TikTok Videobeschreibung</label><textarea id="ttDesc" rows="3" placeholder="Call-to-Action + Keywords + Hashtags"></textarea></div>

        <div class="row">
          <div><label>Datum</label><input id="date" type="date" /></div>
          <div><label>Uhrzeit</label><select id="timeSel"></select></div>
          <div style="display:flex;align-items:flex-end;justify-content:flex-end"><button id="planBtn" disabled>Planen / Speichern</button></div>
        </div>
        <p class="hint">Die Daten werden über <code>/api/db</code> gespeichert (Neon Postgres über Vercel). Keine Keys im Browser.</p>
      </div>

      <div class="card">
        <h2>Bibliothek</h2>
        <table id="libTable"><thead><tr><th>Plattform</th><th>Hook</th><th>Status</th><th>Aktion</th></tr></thead><tbody id="libRows"></tbody></table>
      </div>
    </div>

    <!-- ===== SETTINGS VIEW ===== -->
    <div id="viewSettings" class="hidden">
      <div class="card"><h2>Einstellungen · Accounts & Integrationen</h2></div>
      <div class="card">
        <h3>Integrationen (HeyGen, D‑ID, Json2Video)</h3>
        <div class="row3">
          <div><label>Service</label>
            <select id="int_service">
              <option value="heygen">HeyGen</option>
              <option value="did">D‑ID</option>
              <option value="json2video">Json2Video</option>
            </select>
          </div>
          <div><label>Label</label><input id="int_label"/></div>
          <div><label>API‑Key</label><input id="int_key"/></div>
        </div>
        <div class="row3">
          <div><label>Base URL</label><input id="int_base" value="https://api.heygen.com"/></div>
          <div><label>Avatar / Presenter</label><input id="int_presenter" placeholder="HeyGen Avatar-ID oder pres_…"/></div>
          <div><label>Voice ID</label><input id="int_voice" placeholder="z. B. de-DE-Neural2-D"/></div>
        </div>
        <div class="row3">
          <div><label>Template ID (Json2Video)</label><input id="int_template"/></div>
          <div><label>Notizen</label><input id="int_notes"/></div>
          <div><button id="int_add">Integration speichern</button></div>
        </div>
        <h4>Gespeicherte Integrationen</h4>
        <table><thead><tr><th>Service</th><th>Label</th><th>Avatar</th><th>Voice</th><th>Template</th><th>Base URL</th><th>Aktion</th></tr></thead><tbody id="int_rows"></tbody></table>
      </div>
      <div class="card"><button id="btnBack" class="link">← Zurück zum Composer</button></div>
    </div>
  </div>

  <script>
    // Worker: HeyGen Integration Beispiel
    async function callHeyGen(apiKey, avatarId, voiceId, text, captions, hook, hookOverlay, hookPos){
      const url = "https://api.heygen.com/v1/video.generate";
      const payload = {
        background: "#000000",
        caption: captions,
        input_text: text,
        voice: voiceId,
        avatar_id: avatarId,
        // Hook als Overlay: hier Beispiel mit Textfeld 0–3s
        overlays: hookOverlay ? [{text: hook, start:0, end:3, position: hookPos}] : []
      };
      const res = await fetch(url, {
        method:"POST",
        headers:{"Authorization":`Bearer ${apiKey}","Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
      return await res.json();
    }
  </script>
</body>
</html>
